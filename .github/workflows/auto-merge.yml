name: Dependabot Auto-merge Helper

on:
  pull_request_target:
    types: [opened, reopened, synchronize, labeled]

jobs:
  suggest-auto-merge:
    name: Suggest Auto-merge for Dependabot
    runs-on: ubuntu-latest
    if: >
      github.actor == 'dependabot[bot]' &&
      (github.event.action == 'opened' ||
       github.event.action == 'reopened' ||
       (github.event.action == 'labeled' && github.event.label.name == 'auto-merge'))

    steps:
      - name: Check if PR is from Dependabot
        id: check-dependabot
        uses: actions/github-script@v7
        with:
          script: |
            try {
              const { data: pr } = await github.rest.pulls.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: context.issue.number,
              });

              if (pr.user.login === 'dependabot[bot]' && 
                  pr.labels.some(label => label.name === 'dependencies')) {
                console.log('âœ… This is a Dependabot PR with the dependencies label');
                console.log('\n=== SUGGESTED ACTION ===');
                console.log('To enable auto-merge for this PR:');
                console.log('1. Go to the PR page');
                console.log('2. Click on "Enable auto-merge"');
                console.log('3. Select "Squash and merge"');
                console.log('4. Click "Enable auto-merge"');
                console.log('===========================');
                return true;
              }
              return false;
            } catch (error) {
              console.error('Error checking PR:', error);
              return false;
            }
