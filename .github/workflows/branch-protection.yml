name: Suggest Branch Protection

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to check protection for'
        required: true
        default: 'main'

jobs:
  suggest-protection:
    name: Suggest Branch Protection Rules
    runs-on: ubuntu-latest
    steps:
      - name: Check branch protection
        id: check-protection
        uses: actions/github-script@v7
        with:
          script: |
            try {
              const branch = '${{ github.event.inputs.branch || 'main' }}';
              console.log(`Checking protection for branch: ${branch}`);
              
              // This will fail if no protection exists
              await github.rest.repos.getBranchProtection({
                owner: context.repo.owner,
                repo: context.repo.repo,
                branch: branch
              });
              
              console.log(`✅ Branch '${branch}' is already protected`);
              return true;
            } catch (error) {
              if (error.status === 404) {
                console.log('⚠️ No branch protection found. Please enable branch protection with these recommended settings:');
                console.log('\n=== RECOMMENDED BRANCH PROTECTION SETTINGS ===');
                console.log('1. Require a pull request before merging');
                console.log('   - Require approvals: 1');
                console.log('   - Dismiss stale pull request approvals when new commits are pushed: true');
                console.log('   - Require code owner review: true');
                console.log('2. Require status checks to pass before merging');
                console.log('   - Require branches to be up to date before merging: true');
                console.log('   - Status checks that are required: lint-and-typecheck, test');
                console.log('3. Require conversation resolution before merging: true');
                console.log('4. Do not allow bypassing the above settings');
                console.log('5. Restrict who can push to matching branches: (specify team or users)');
                console.log('6. Allow force pushes: false');
                console.log('7. Allow deletions: false');
                console.log('==============================================');
                return false;
              }
              throw error;
            }
